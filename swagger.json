{
  "openapi": "3.0.0",
  "info": {
    "title": "API Emision RCV - Vertice Seguros",
    "version": "1.0.0",
    "description": "Documentacion de endpoints temporales para emision de polizas RCV"
  },
  "paths": {
    "/auth": {
      "post": {
        "summary": "Autenticación de usuario",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "username": { "type": "string", "example": "admin" },
                  "password": { "type": "string", "example": "admin1234" }
                },
                "required": ["username", "password"]
              },
              "example": {
                "username": "admin",
                "password": "admin1234"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Token JWT generado",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "access_token": { "type": "string" },
                    "exp": { "type": "integer" }
                  }
                }
              }
            }
          },
          "401": { "description": "Credenciales inválidas" }
        }
      }
    },
    "/cotizacion": {
      "post": {
        "summary": "Solicitar cotización RCV",
        "security": [{ "bearerAuth": [] }],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "data": {
                    "type": "object",
                    "properties": {
                      "generalData": { "$ref": "#/components/schemas/GeneralData" },
                      "carData": { "$ref": "#/components/schemas/CarData" },
                      "generalDataTomador": { "$ref": "#/components/schemas/GeneralDataTomador" }
                    },
                    "required": ["generalData", "carData"]
                  }
                },
                "required": ["data"]
              },
              "examples": {
                "Sin tomador": {
                  "summary": "Cotización sin tomador (solo titular)",
                  "value": {
                    "data": {
                      "generalData": {
                        "policy_holder_type_document": "V",
                        "policy_holder_document_number": 12345678,
                        "policy_holder_phone": "04141234567",
                        "policy_holder_email": "titular@email.com",
                        "policy_holder": "Juan Pérez",
                        "policy_holder_address": "Calle 1",
                        "policy_holder_state": "Miranda",
                        "policy_holder_city": "Caracas",
                        "policy_holder_municipality": "Libertador",
                        "issuer_store": "Sucursal Centro"
                      },
                      "carData": {
                        "type_plate": "A",
                        "plate": "ABC123",
                        "brand": "Toyota",
                        "model": "Corolla",
                        "version": "LE",
                        "year": 2022,
                        "color": "Blanco",
                        "gearbox": "Automático",
                        "carroceria_serial_number": "1234567890",
                        "motor_serial_number": "0987654321",
                        "type_vehiculo": "particular",
                        "use": "Hasta 800 kg. de peso",
                        "passenger_qty": 5,
                        "driver": "Juan Pérez",
                        "use_grua": true
                      }
                    }
                  }
                },
                "Con tomador": {
                  "summary": "Cotización con tomador distinto al titular",
                  "value": {
                    "data": {
                      "generalData": {
                        "policy_holder_type_document": "V",
                        "policy_holder_document_number": 12345678,
                        "policy_holder_phone": "04141234567",
                        "policy_holder_email": "titular@email.com",
                        "policy_holder": "Juan Pérez",
                        "policy_holder_address": "Calle 1",
                        "policy_holder_state": "Miranda",
                        "policy_holder_city": "Caracas",
                        "policy_holder_municipality": "Libertador",
                        "issuer_store": "Sucursal Centro"
                      },
                      "carData": {
                        "type_plate": "A",
                        "plate": "DEF456",
                        "brand": "Chevrolet",
                        "model": "Aveo",
                        "version": "LS",
                        "year": 2020,
                        "color": "Negro",
                        "gearbox": "Manual",
                        "carroceria_serial_number": "1122334455",
                        "motor_serial_number": "5544332211",
                        "type_vehiculo": "carga",
                        "use": "Hasta 2 TM",
                        "passenger_qty": 5,
                        "driver": "Pedro Gómez",
                        "use_grua": false
                      },
                      "generalDataTomador": {
                        "type_document": "E",
                        "insured_document": 87654321,
                        "insured_phone": "04149876543",
                        "insured_email": "tomador@email.com",
                        "insured": "Pedro Gómez",
                        "insured_address": "Calle 2",
                        "insured_state": "Miranda",
                        "insured_city": "Guarenas",
                        "insured_municipality": "Plaza",
                        "issuer_store": "Sucursal Este"
                      }
                    }
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Cotización generada",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/QuotationResult"
                }
              }
            }
          },
          "400": { "description": "Request Body incompleto" },
          "401": { "description": "No autorizado" },
          "500": { "description": "Error interno del servidor" }
        }
      }
    },
    "/verify": {
      "post": {
        "summary": "Verificar si una placa ya está asociada a una póliza previa",
        "security": [{ "bearerAuth": [] }],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "policy_holder_type_document": { "type": "string", "example": "V" },
                  "policy_holder_document_number": { "type": "string", "example": "12345678" },
                  "plate": { "type": "string", "example": "ABC123" }
                },
                "required": ["policy_holder_type_document", "policy_holder_document_number", "plate"]
              },
              "examples": {
                "Placa no existe": {
                  "summary": "Placa no registrada",
                  "value": {
                    "policy_holder_type_document": "V",
                    "policy_holder_document_number": "12345678",
                    "plate": "NOEXISTE1"
                  }
                },
                "Placa ya existe": {
                  "summary": "Placa ya asociada a póliza",
                  "value": {
                    "policy_holder_type_document": "V",
                    "policy_holder_document_number": "12345678",
                    "plate": "ABC123"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Resultado de la verificación de la placa",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": { "type": "string", "example": "La placa ya existe" }
                  }
                },
                "examples": {
                  "Placa no existe": { "value": { "message": "La placa no existe" } },
                  "Placa ya existe": { "value": { "message": "La placa ya existe" } }
                }
              }
            }
          },
          "400": { "description": "Faltan datos requeridos" },
          "401": { "description": "No autorizado" },
          "500": { "description": "Error interno del servidor" }
        }
      }
    },
    "/sypago/auth": {
      "post": {
        "summary": "Obtener token SyPago",
        "description": "Obtiene un token de autenticación de SyPago. No requiere cuerpo.",
        "responses": {
          "200": { "description": "Token obtenido correctamente" },
          "500": { "description": "Error al conectar con la API de SyPago" }
        }
      }
    },
    "/sypago/bankOptions": {
      "get": {
        "summary": "Obtener bancos disponibles SyPago",
        "description": "Obtiene la lista de bancos disponibles desde SyPago.",
        "responses": {
          "200": { "description": "Lista de bancos obtenida correctamente" },
          "500": { "description": "Error al conectar con la API de SyPago" }
        }
      }
    },
    "/sypago/tasa": {
      "get": {
        "summary": "Obtener tasa BCV SyPago",
        "description": "Obtiene la tasa BCV desde SyPago.",
        "responses": {
          "200": { "description": "Tasa BCV obtenida correctamente" },
          "500": { "description": "Error al conectar con la API de SyPago" }
        }
      }
    },
    "/sypago/otp": {
      "post": {
        "summary": "Solicitar código OTP SyPago",
        "description": "Solicita un código OTP a SyPago. Requiere autenticación previa en /sypago/auth.",
        "security": [ { "sypagoToken": [] } ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "creditor_account": {
                    "type": "object",
                    "properties": {
                      "bank_code": { "type": "string", "example": "0001" },
                      "type": { "type": "string", "example": "CNTA" },
                      "number": { "type": "string", "example": "00014166604867298461" }
                    },
                    "required": ["bank_code", "type", "number"]
                  },
                  "debitor_document_info": {
                    "type": "object",
                    "properties": {
                      "type": { "type": "string", "example": "V" },
                      "number": { "type": "string", "example": "28131782" }
                    },
                    "required": ["type", "number"]
                  },
                  "debitor_account": {
                    "type": "object",
                    "properties": {
                      "bank_code": { "type": "string", "example": "0134" },
                      "type": { "type": "string", "example": "CELE" },
                      "number": { "type": "string", "example": "04147232513" }
                    },
                    "required": ["bank_code", "type", "number"]
                  },
                  "amount": {
                    "type": "object",
                    "properties": {
                      "amt": { "type": "number", "example": 20 },
                      "currency": { "type": "string", "example": "VES" }
                    },
                    "required": ["amt", "currency"]
                  }
                },
                "required": ["creditor_account", "debitor_document_info", "debitor_account", "amount"]
              },
              "example": {
                "creditor_account": {
                  "bank_code": "0001",
                  "type": "CNTA",
                  "number": "00014166604867298461"
                },
                "debitor_document_info": {
                  "type": "V",
                  "number": "28131782"
                },
                "debitor_account": {
                  "bank_code": "0134",
                  "type": "CELE",
                  "number": "04147232513"
                },
                "amount": {
                  "amt": 20,
                  "currency": "VES"
                }
              }
            }
          }
        },
        "responses": {
          "200": { "description": "OTP solicitado correctamente" },
          "401": { "description": "No SyPago token. Autentíquese primero en /sypago/auth." },
          "500": { "description": "Error al conectar con la API de SyPago" }
        }
      }
    },
    "/sypago/otp/code": {
      "post": {
        "summary": "Validar código OTP SyPago",
        "description": "Valida el código OTP recibido por SyPago. Requiere autenticación previa en /sypago/auth.",
        "security": [ { "sypagoToken": [] } ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "type": "object" },
              "example": {
                "otp": "123456",
                "transaction_id": "abc123"
              }
            }
          }
        },
        "responses": {
          "200": { "description": "OTP validado correctamente" },
          "401": { "description": "No SyPago token. Autentíquese primero en /sypago/auth." },
          "500": { "description": "Error al conectar con la API de SyPago" }
        }
      }
    }
  },
  "components": {
    "securitySchemes": {
      "bearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT"
      },
      "sypagoToken": {
        "type": "apiKey",
        "in": "header",
        "name": "SyPago-Token",
        "description": "Token SyPago obtenido desde /sypago/auth o el endpoint correspondiente."
      }
    },
    "schemas": {
      "GeneralData": {
        "type": "object",
        "properties": {
          "policy_holder_type_document": { "type": "string" },
          "policy_holder_document_number": { "type": "integer" },
          "policy_holder_phone": { "type": "string" },
          "policy_holder_email": { "type": "string" },
          "policy_holder": { "type": "string" },
          "policy_holder_address": { "type": "string" },
          "policy_holder_state": { "type": "string" },
          "policy_holder_city": { "type": "string" },
          "policy_holder_municipality": { "type": "string" },
          "issuer_store": { "type": "string" }
        },
        "required": ["policy_holder_type_document", "policy_holder_document_number", "policy_holder", "policy_holder_address", "policy_holder_state", "policy_holder_city"]
      },
      "CarData": {
        "type": "object",
        "properties": {
          "type_plate": { "type": "string" },
          "plate": { "type": "string" },
          "brand": { "type": "string" },
          "model": { "type": "string" },
          "version": { "type": "string" },
          "year": { "type": "integer" },
          "color": { "type": "string" },
          "gearbox": { "type": "string" },
          "carroceria_serial_number": { "type": "string" },
          "motor_serial_number": { "type": "string" },
          "type_vehiculo": { "type": "string" },
          "use": { "type": "string" },
          "passenger_qty": { "type": "integer" },
          "driver": { "type": "string" },
          "use_grua": { "type": "boolean" }
        },
        "required": ["type_plate", "plate", "brand", "model", "year", "carroceria_serial_number", "motor_serial_number", "type_vehiculo", "use", "passenger_qty", "driver", "use_grua"]
      },
      "GeneralDataTomador": {
        "type": "object",
        "properties": {
          "type_document": { "type": "string" },
          "insured_document": { "type": "integer" },
          "insured_phone": { "type": "string" },
          "insured_email": { "type": "string" },
          "insured": { "type": "string" },
          "insured_address": { "type": "string" },
          "insured_state": { "type": "string" },
          "insured_city": { "type": "string" },
          "insured_municipality": { "type": "string" },
          "issuer_store": { "type": "string" }
        }
      },
      "QuotationResult": {
        "type": "object",
        "properties": {
          "primaTotal": {
            "type": "object",
            "properties": {
              "dolar": { "type": "number" },
              "bs": { "type": "number" }
            }
          },
          "coberturas": {
            "type": "object",
            "properties": {
              "danosPersonas": { "type": "number" },
              "danosCosas": { "type": "number" }
            }
          }
        }
      }
    }
  }
}
